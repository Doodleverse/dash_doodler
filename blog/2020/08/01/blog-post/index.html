<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/dash_doodler/blog/rss.xml" title="Doodler Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/dash_doodler/blog/atom.xml" title="Doodler Blog Atom Feed"><title data-react-helmet="true">Doodler</title><meta data-react-helmet="true" name="description" content="Doodler can work with really large images, but it is usually best to keep your images &lt; 10,000 pixels in any dimension, because then the program will do CRF inference on the whole image at once rather than in chunks. This usually results in better image segmentations that are more consistent with your doodles."><meta data-react-helmet="true" property="og:description" content="Doodler can work with really large images, but it is usually best to keep your images &lt; 10,000 pixels in any dimension, because then the program will do CRF inference on the whole image at once rather than in chunks. This usually results in better image segmentations that are more consistent with your doodles."><meta data-react-helmet="true" property="og:url" content="https://dbuscombe-usgs.github.io/dash_doodler/blog/2020/08/01/blog-post"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Doodler"><link data-react-helmet="true" rel="shortcut icon" href="/dash_doodler/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dbuscombe-usgs.github.io/dash_doodler/blog/2020/08/01/blog-post"><link data-react-helmet="true" rel="alternate" href="https://dbuscombe-usgs.github.io/dash_doodler/blog/2020/08/01/blog-post" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dbuscombe-usgs.github.io/dash_doodler/blog/2020/08/01/blog-post" hreflang="x-default"><link rel="stylesheet" href="/dash_doodler/assets/css/styles.8f634425.css">
<link rel="preload" href="/dash_doodler/assets/js/styles.546c2e3a.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/runtime~main.641d5464.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/main.8381047b.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/1.29a93b55.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/2.5a4d1931.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/3.cf36bd72.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/ccc49370.423afd9a.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/587af817.48f3a84f.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/1058673d.a1196b83.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dash_doodler/"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title"></strong></a><a class="navbar__item navbar__link" href="/dash_doodler/docs/intro">Tutorials</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/dash_doodler/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/dbuscombe-usgs/dash_doodler" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Doodler github page</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/dash_doodler/"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/dash_doodler/docs/intro">Tutorials</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/dash_doodler/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/dbuscombe-usgs/dash_doodler" target="_blank" rel="noopener noreferrer" class="menu__link">Doodler github page</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/dash_doodler/blog/2021/11/30/Behind-the-Scenes-with-Doodler">Behind the Scenes with Doodler</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/dash_doodler/blog/2021/08/28/blog-post">Changes in v 1.2.6</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/dash_doodler/blog/2021/07/09/Doodler-Shape">How to Change Doodle&#x27;s Shape</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/dash_doodler/blog/2021/07/08/Doodler-Zoom">How to Use Zoom &amp; Pan Tools</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/dash_doodler/blog/2021/07/08/Doodler-Erase">How to Use the Erase Tool</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Splitting up large geoTIFF orthomosaics</h1><div class="margin-vert--md"><time datetime="2020-08-01T00:00:00.000Z" class="blogPostDate_fNvV">July 31, 2020 Â· 2 min read</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"><h4 class="avatar__name"><a href="http://twitter.com/magic_walnut" target="_blank" rel="noopener noreferrer">Dan Buscombe</a></h4><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p><code>Doodler</code> can work with really large images, but it is usually best to keep your images &lt; 10,000 pixels in any dimension, because then the program will do CRF inference on the whole image at once rather than in chunks. This usually results in better image segmentations that are more consistent with your doodles.</p><p>So, this post is all about how you make smaller image tiles from a very large geoTIFF format orthomosaic, using python. The smaller tiles will also be written out as image tiles, with their relative position in the larger image described in the file name, for easy reassembly</p><p>We&#x27;ll need a dependency not included in the <code>doodler</code> environment: <code>gdal</code></p><p><code>conda install gdal</code></p><p>Now, in python:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import os, gdal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from gdalconst import *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from glob import glob</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>How large do you want your output (square) image tiles to be? (in pixels)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">tilesize = 5000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>What images would you like to chop up?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">bigfiles = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;Sandwich/2017-01-09_Sandwich_5cm_ortho.tif&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;Sandwich/2017-02-14_Sandwich_5cm_ortho.tif&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;Sandwich/2017-03-16_Sandwich_5cm_ortho.tif&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;Sandwich/2018-01-10_Sandwich_5cm_ortho.tif&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>List the widths and heights of those input <code>bigfiles</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">widths = [13314, 13314, 13314, 19972]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">heights = [6212, 6212, 6212, 9319]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Specify a new folder for each set of image tiles (one per big image)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">folders = [&#x27;Sandwich/2017-01-09_5cm&#x27;, &#x27;Sandwich/2017-02-14_5cm&#x27;,\</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;Sandwich/2017-03-16_5cm&#x27;,&#x27;Sandwich/2017-01-10_5cm&#x27;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Make file name prefixes by borrowing the folder name:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">prefixes = [f.split(&#x27;/&#x27;)[-1] for f in folders]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Finally, loop through each file, chop it into chunks using <code>gdal_translate</code>, called by an <code>os.system()</code> command. Then moves the tiles into their respective folders</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">for b,f,p in zip(bigfiles, folders, prefixes):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # chop the image into chunks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    for i in range(0, widths[k], tilesize):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        for j in range(0, heights[k], tilesize):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            gdaltranString = &quot;gdal_translate -of GTIFF -srcwin &quot;+str(i)+&quot;, &quot;+str(j)+&quot;, &quot;+str(tilesize)+&quot;, &quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                +str(tilesize)+&quot; &quot;+b+&quot; &quot;+p+&quot;_&quot;+str(i)+&quot;_&quot;+str(j)+&quot;.tif&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            os.system(gdaltranString)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ##move those chunks to a directory</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    os.mkdir(f)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    os.system(&#x27;mv &#x27;+p+&#x27;*.tif &#x27;+f)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div></article><div><a href="https://github.com/dbuscombe-usgs/dash_doodler/edit/master/website/blog/blog/2020-08-01-blog-post.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dash_doodler/blog/2021/05/09/blog-post"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« How to split up large photos</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dash_doodler/blog/2020/07/31/blog-post"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">merge a 3-band and 1-band image Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dash_doodler/docs/intro">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/dbuscombe-usgs/coast_train" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coast Train</a></li><li class="footer__item"><a href="https://www.usgs.gov/centers/pcmsc/science/remote-sensing-coastal-change?qt-science_center_objects=0#qt-science_center_objects" target="_blank" rel="noopener noreferrer" class="footer__link-item">USGS Remote Sensing Coastal Change</a></li><li class="footer__item"><a href="https://coastalimagelabeler.science/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coastal Image Labeler by Dr Evan Goldstein</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dash_doodler/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/dbuscombe-usgs/dash_doodler" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://www.makesense.ai/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Makesense.ai (an alternative way to segment imagery)</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Doodler is written and maintained by Daniel Buscombe, Marda Science, LLC, contracted to the U.S. Geological Survey Pacific Coastal and Marine Science Center in Santa Cruz, CA. Doodler development is funded by the U.S. Geological Survey Coastal Hazards Program, and is for the primary usage of U.S. Geological Survey scientists, researchers and affiliated colleagues working on the Hurricane Florence Supplemental Project and other coastal hazards research. Thanks to Jon Warrick, Phil Wernette, Chris Sherwood, Jenna Brown, Andy Ritchie, Jin-Si Over, Christine Kranenburg, and the rest of the Florence Supplemental team; to Evan Goldstein and colleagues at University of North Carolina Greensboro; Leslie Hsu at the USGS Community for Data Integration; and LCDR Brodie Wells, formerly of Naval Postgraduate School, Monterey. Copyright Â© 2021 Marda Science, LLC. </div></div></div></footer></div>
<script src="/dash_doodler/assets/js/styles.546c2e3a.js"></script>
<script src="/dash_doodler/assets/js/runtime~main.641d5464.js"></script>
<script src="/dash_doodler/assets/js/main.8381047b.js"></script>
<script src="/dash_doodler/assets/js/1.29a93b55.js"></script>
<script src="/dash_doodler/assets/js/2.5a4d1931.js"></script>
<script src="/dash_doodler/assets/js/3.cf36bd72.js"></script>
<script src="/dash_doodler/assets/js/ccc49370.423afd9a.js"></script>
<script src="/dash_doodler/assets/js/587af817.48f3a84f.js"></script>
<script src="/dash_doodler/assets/js/1058673d.a1196b83.js"></script>
</body>
</html>