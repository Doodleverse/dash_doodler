<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/dash_doodler/blog/rss.xml" title="Doodler Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/dash_doodler/blog/atom.xml" title="Doodler Blog Atom Feed"><title data-react-helmet="true">[ADVANCED] Serving Doodler as a web application for others to use | Doodler</title><meta data-react-helmet="true" property="og:url" content="https://dbuscombe-usgs.github.io/dash_doodler/docs/tutorial-extras/deploy-server"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="[ADVANCED] Serving Doodler as a web application for others to use | Doodler"><meta data-react-helmet="true" name="description" content="(page under construction)"><meta data-react-helmet="true" property="og:description" content="(page under construction)"><link data-react-helmet="true" rel="shortcut icon" href="/dash_doodler/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dbuscombe-usgs.github.io/dash_doodler/docs/tutorial-extras/deploy-server"><link data-react-helmet="true" rel="alternate" href="https://dbuscombe-usgs.github.io/dash_doodler/docs/tutorial-extras/deploy-server" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dbuscombe-usgs.github.io/dash_doodler/docs/tutorial-extras/deploy-server" hreflang="x-default"><link rel="stylesheet" href="/dash_doodler/assets/css/styles.8f634425.css">
<link rel="preload" href="/dash_doodler/assets/js/styles.f681044a.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/runtime~main.fdeca4e3.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/main.3eb69755.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/1.aeae5514.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/2.343bca5c.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/60.948fbc65.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/62.c3115978.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/935f2afb.a930908d.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/17896441.e9523a68.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/4dbe94a1.d5558abd.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dash_doodler/"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title"></strong></a><a class="navbar__item navbar__link navbar__link--active" href="/dash_doodler/docs/intro">Tutorials</a><a class="navbar__item navbar__link" href="/dash_doodler/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/dbuscombe-usgs/dash_doodler" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Doodler github page</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/dash_doodler/"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/dash_doodler/docs/intro">Tutorials</a></li><li class="menu__list-item"><a class="menu__link" href="/dash_doodler/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/dbuscombe-usgs/dash_doodler" target="_blank" rel="noopener noreferrer" class="menu__link">Doodler github page</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/dash_doodler/docs/intro">What is Doodler for?</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Doodler - Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/tutorial-basics/deploy-local">Installing Doodler on a PC for your own use</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/tutorial-basics/what-to-do">What to do</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/tutorial-basics/how-to-doodle">How to Doodle well</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/tutorial-basics/utilities">Utility scripts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/tutorial-basics/faqs">Frequently Asked Questions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/tutorial-basics/getting-help">Getting help</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Doodler - Extras</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dash_doodler/docs/tutorial-extras/how-doodler-works">[ADVANCED] How Doodler works</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/dash_doodler/docs/tutorial-extras/deploy-server">[ADVANCED] Serving Doodler as a web application for others to use</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dash_doodler/docs/tutorial-extras/how-to-contribute">[ADVANCED] How to contribute</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dash_doodler/docs/tutorial-extras/next-steps">[ADVANCED] Next steps .... training a Deep Learning model for image segmentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dash_doodler/docs/tutorial-extras/references">[ADVANCED] References</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Case Studies</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/case-studies/case-study1">Case Study 1: Greyscale geophysical imagery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/case-studies/case-study2">Case Study 3: NOAA post-hurricane reconnaissance aerial imagery</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">[ADVANCED] Serving Doodler as a web application for others to use</h1></header><div class="markdown"><p>(page under construction)</p><p>These instructions assume you are using Ubuntu 20.04 (LTS) x64 on a Digital Ocean Droplet Virtual Machine (VM). You would need to adapt them to a different platform or OS</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-the-droplet"></a>Setting up the droplet<a class="hash-link" href="#setting-up-the-droplet" title="Direct link to heading">#</a></h3><p>Below, you custom URL is called <code>$URL</code> and your IP address is written as <code>$IP</code> instead your actual IP address, XXX.XX.XXX.XXX</p><ol><li>Under Networkin/Domains, add your <code>$URL</code> and www.<code>$URL</code> as separate domains, and redirect both of them to <code>$IP</code></li><li>For each domain, you should have DNS records for 3 nameservers, ns1.digitalocean.com, ns2.digitalocean.com., and n3.digitalocean.com.</li><li>Those same nameservers should be linked as custom nameservers with your domain name provider (I used namecheap.com)</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-newuser-firewalls-and-installing-anaconda"></a>Setting up newuser, firewalls, and installing anaconda<a class="hash-link" href="#setting-up-newuser-firewalls-and-installing-anaconda" title="Direct link to heading">#</a></h3><p>Below, the new user is called <code>newuser</code>, but you&#x27;d probably want to use something more suited to you, the sysadmin</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh root@$IP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo adduser newuser</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">usermod -aG sudo newuser</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ufw allow OpenSSH</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ufw enable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Log in as <code>newuser</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh newuser@$IP</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Install Anaconda3</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">wget https://repo.anaconda.com/archive/Anaconda3-2019.03-Linux-x86_64.sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">bash Anaconda3-2019.03-Linux-x86_64.sh</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Allow some ports and other tings on the firewall, ufw</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ufw allow 8050</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ufw allow 80</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ufw allow ssh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ufw allow http</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ufw allow https</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="downloading-doodler-code-setting-up-conda-env"></a>Downloading doodler code, setting up conda env<a class="hash-link" href="#downloading-doodler-code-setting-up-conda-env" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git clone --depth 1 https://github.com/dbuscombe-usgs/dash_doodler.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd dash_doodler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">conda env create --file install/dashdoodler.yml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">conda activate dashdoodler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">conda install gunicorn</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="add-user-authentication-and-test-locally"></a>Add user authentication, and test locally<a class="hash-link" href="#add-user-authentication-and-test-locally" title="Direct link to heading">#</a></h3><p>Install <code>dash-auth</code> to handle user authentication</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pip install dash-auth</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Deactivate the environment, we no longer need it active</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">conda deactivate</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Type <code>nano doodler.py</code> and add</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import dash_auth</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>in the imports section at the top, then replace</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">app = dash.Dash(__name__)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>with</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">server = Flask(__name__)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">app = dash.Dash(server=server)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This will tell gunicorn what object to serve (<code>server</code>) and makes use of Flask instead of Dash.</p><p>Add users and password combos just below like this</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">VALID_USERNAME_PASSWORD_PAIRS = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;user&#x27;: &#x27;password&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">auth = dash_auth.BasicAuth(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    app,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    VALID_USERNAME_PASSWORD_PAIRS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Run this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/home/newuser/anaconda3/envs/dashdoodler/bin/gunicorn --bind 0.0.0.0:8050 --timeout 600 doodler:server</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>And open a web browser and go here:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">http://$IP:8050</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You should see the Doodler app, and you can log in using the credentials you set above</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-your-web-server-ssl-and-custom-url-redirects"></a>Setting up your web server, SSL and custom URL redirects<a class="hash-link" href="#setting-up-your-web-server-ssl-and-custom-url-redirects" title="Direct link to heading">#</a></h3><p>Install nginx (for web serving) and certbot (for ssl)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo apt install nginx</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo apt-get install python3-certbot-nginx</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Test getting your SSL certs in dry run mode</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo certbot --nginx -d $URL -d www.$URL certonly --dry-run</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Assuming that completed without error, run for real:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo certbot --nginx -d $URL -d www.$URL</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>See the certificate here: &quot;<a href="https://www.ssllabs.com/ssltest/analyze.html?d=$URL&amp;latest%22" target="_blank" rel="noopener noreferrer">https://www.ssllabs.com/ssltest/analyze.html?d=$URL&amp;latest&quot;</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-doodler-as-a-background-service"></a>Setting up Doodler as a background service<a class="hash-link" href="#setting-up-doodler-as-a-background-service" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo nano /etc/systemd/system/doodler.service</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[Unit]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Description=Gunicorn instance to serve myproject</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">After=network.target</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[Service]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">User=newuser</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Group=www-data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">WorkingDirectory=/home/newuser/dash_doodler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Environment=&quot;PATH=/home/newuser/anaconda3/envs/dashdoodler/bin&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStart=/home/newuser/anaconda3/envs/dashdoodler/bin/gunicorn --workers 3 --bind unix:/home/newuser/dash_doodler/doodler.sock -m 007 --bind 0.0.0.0:8050 --timeout 600 doodler:server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[Install]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">WantedBy=multi-user.target</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Then run these commands</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo systemctl stop doodler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo systemctl daemon-reload</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo systemctl start doodler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo systemctl enable doodler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo systemctl status doodler</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>open a web browser and go here:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">http://$IP:8050</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>And you should see Doodler. The service works. This should work on reboot, and in the background. Check on it any time using</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo systemctl status doodler</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-url-redirect"></a>Setting $URL redirect<a class="hash-link" href="#setting-url-redirect" title="Direct link to heading">#</a></h3><p>Edit this file:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo nano /etc/nginx/sites-available/default</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Like this (replacing <code>$URL</code> with whatever it is):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">        # Add index.php to the list if you are using PHP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        index index.html index.htm index.nginx-debian.html;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        server_name $URL www.$URL;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        location / {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                # First attempt to serve request as file, then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                # as directory, then fall back to displaying a 404.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                #try_files $uri $uri/ =404;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    location / {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        proxy_pass http://0.0.0.0:8050;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        proxy_http_version 1.1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        proxy_set_header Upgrade $http_upgrade;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        proxy_set_header Connection &#x27;upgrade&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        proxy_set_header Host $host;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        proxy_cache_bypass $http_upgrade;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Test the config files</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo nginx -t</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Restart nginx and update the firewall</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo systemctl restart nginx</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ufw allow &#x27;Nginx Full&#x27; #allows 80 and 443</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ow your doodler service will be running the app at</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">http://$IP:8050</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>which redirects to</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">http://$URL</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>and finally to</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">https://$URL</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>I carried out this process and have a site hosted <a href="https://doodler.xyz/" target="_blank" rel="noopener noreferrer">here</a></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/dbuscombe-usgs/dash_doodler/edit/master/website/docs/tutorial-extras/deploy-server.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dash_doodler/docs/tutorial-extras/how-doodler-works"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« [ADVANCED] How Doodler works</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dash_doodler/docs/tutorial-extras/how-to-contribute"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">[ADVANCED] How to contribute Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setting-up-the-droplet" class="table-of-contents__link">Setting up the droplet</a></li><li><a href="#setting-up-newuser-firewalls-and-installing-anaconda" class="table-of-contents__link">Setting up newuser, firewalls, and installing anaconda</a></li><li><a href="#downloading-doodler-code-setting-up-conda-env" class="table-of-contents__link">Downloading doodler code, setting up conda env</a></li><li><a href="#add-user-authentication-and-test-locally" class="table-of-contents__link">Add user authentication, and test locally</a></li><li><a href="#setting-up-your-web-server-ssl-and-custom-url-redirects" class="table-of-contents__link">Setting up your web server, SSL and custom URL redirects</a></li><li><a href="#setting-up-doodler-as-a-background-service" class="table-of-contents__link">Setting up Doodler as a background service</a></li><li><a href="#setting-url-redirect" class="table-of-contents__link">Setting $URL redirect</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dash_doodler/docs/intro">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/dbuscombe-usgs/coast_train" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coast Train</a></li><li class="footer__item"><a href="https://www.usgs.gov/centers/pcmsc/science/remote-sensing-coastal-change?qt-science_center_objects=0#qt-science_center_objects" target="_blank" rel="noopener noreferrer" class="footer__link-item">USGS Remote Sensing Coastal Change</a></li><li class="footer__item"><a href="https://coastalimagelabeler.science/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coastal Image Labeler by Dr Evan Goldstein</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dash_doodler/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/dbuscombe-usgs/dash_doodler" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://www.makesense.ai/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Makesense.ai (an alternative way to segment imagery)</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Doodler is written and maintained by Daniel Buscombe, Marda Science, LLC, contracted to the U.S. Geological Survey Pacific Coastal and Marine Science Center in Santa Cruz, CA. Doodler development is funded by the U.S. Geological Survey Coastal Hazards Program, and is for the primary usage of U.S. Geological Survey scientists, researchers and affiliated colleagues working on the Hurricane Florence Supplemental Project and other coastal hazards research. Thanks to Jon Warrick, Phil Wernette, Chris Sherwood, Jenna Brown, Andy Ritchie, Jin-Si Over, Christine Kranenburg, and the rest of the Florence Supplemental team; to Evan Goldstein and colleagues at University of North Carolina Greensboro; Leslie Hsu at the USGS Community for Data Integration; and LCDR Brodie Wells, formerly of Naval Postgraduate School, Monterey. Copyright Â© 2021 Marda Science, LLC. </div></div></div></footer></div>
<script src="/dash_doodler/assets/js/styles.f681044a.js"></script>
<script src="/dash_doodler/assets/js/runtime~main.fdeca4e3.js"></script>
<script src="/dash_doodler/assets/js/main.3eb69755.js"></script>
<script src="/dash_doodler/assets/js/1.aeae5514.js"></script>
<script src="/dash_doodler/assets/js/2.343bca5c.js"></script>
<script src="/dash_doodler/assets/js/60.948fbc65.js"></script>
<script src="/dash_doodler/assets/js/62.c3115978.js"></script>
<script src="/dash_doodler/assets/js/935f2afb.a930908d.js"></script>
<script src="/dash_doodler/assets/js/17896441.e9523a68.js"></script>
<script src="/dash_doodler/assets/js/4dbe94a1.d5558abd.js"></script>
</body>
</html>